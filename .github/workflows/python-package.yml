# This workflow will install Python dependencies, run tests and lint with a variety of Python versions
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-python

name: Python package

on:
  push:
    branches: [ 'main' ]
  pull_request:
    branches: [ 'main' ]


jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        python-version: ['3.11']
        os: ['ubuntu-20.04','windows-2019']
    runs-on: ${{ matrix.os }} 
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v3
        with:
          python-version: ${{ matrix.python-version }}
          cache: 'pip'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install Flask PyInstaller
      - name: Build with PyInstaller
        if: ${{ matrix.os == 'ubuntu-20.04' }}
        run: |
          echo "[]" > babsmile.json
          pyinstaller babsmilemanager.py -F \
          --add-data babsmilemanager/static/:babsmilemanager/static/ \
          --add-data babsmilemanager/templates/:babsmilemanager/templates/ \
          --add-data babsmile.json:babsmile.json  \
          --console --hide-console minimize-late \
          --icon babsmilemanager/static/favicon.ico
          chmod +x dist/babsmilemanager
      - name: Build with PyInstaller
        if: ${{ matrix.os == 'windows-2019' }}
        run: |
          echo "[]" > babsmile.json
          pyinstaller babsmilemanager.py -F --add-data babsmilemanager\static:babsmilemanager\static ^
          --add-data babsmilemanager\templates:babsmilemanager\templates ^
          --add-data babsmile.json:babsmile.json  ^
          --console -hide-console minimize-late ^
          --icon babsmilemanager/static/favicon.ico
      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v4.0.0
        with:
          name: BabSmileManager-${{ matrix.os }}
          path: dist/babsmilemanager*
